# RAG降级检索常识阈值说明 v3.3.2.7

## ?? **当前配置**

### **阈值设置：**
```csharp
e.importance >= 0.7f  // 重要性>=0.7的常识会被检索
.Take(20)            // 最多20条
```

### **性能估算：**
- **扫描速度**：~0.1ms（100条常识）
- **评分速度**：~0.3ms/条
- **总耗时**：3-6ms（10-20条常识）

---

## ?? **调整建议**

### **如果常识库较小（<50条）：**
```csharp
// 可以降低阈值或移除限制
.Where(e => e.isEnabled && e.importance >= 0.5f)  // 降到0.5
.Take(30)  // 增加到30条
```

### **如果常识库较大（>200条）：**
```csharp
// 保持当前配置或提高阈值
.Where(e => e.isEnabled && e.importance >= 0.8f)  // 提高到0.8
.Take(15)  // 减少到15条
```

### **性能优先（追求零卡顿）：**
```csharp
// 只检索最重要的常识
.Where(e => e.isEnabled && e.importance >= 0.9f)
.Take(10)
```

---

## ?? **推荐策略**

### **伊什穆蒂特场景：**
如果你的常识是：
```
[伊什穆蒂特|0.8]一种沙狐最爱的冰淇淋口味
```

**当前配置**：? 会被检索（0.8 >= 0.7）

**如果设置为0.5**：
```
[伊什穆蒂特|0.5]一种冰淇淋
```
也会被检索（0.5 >= 0.5）

---

## ?? **性能 vs 准确性权衡**

| 阈值 | 检索数量 | 性能 | 准确性 |
|------|---------|------|--------|
| 0.9  | ~5条    | ? 极快(<2ms) | ?? 可能遗漏 |
| **0.7** | ~10-20条 | ? 快(<5ms) | ? 平衡 |
| 0.5  | ~30-50条 | ?? 中(~10ms) | ?? 更全面 |
| 无限制 | 全部    | ? 慢(>30ms) | ? 最全面 |

**推荐：保持0.7！**

---

## ?? **最终修复验证**

**修复后效果：**
1. ? 降级检索也会包含常识
2. ? 性能开销可控（<5ms）
3. ? 不会阻塞主线程UI
4. ? 伊什穆蒂特（0.8）会被检索

**部署并测试！** ??
