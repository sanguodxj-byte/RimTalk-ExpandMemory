[33m6fc7572[m[33m ([m[1;36mHEAD[m[33m -> [m[1;32mmain[m[33m, [m[1;31morigin/main[m[33m, [m[1;31morigin/HEAD[m[33m)[m v3.3.2.37: 新增提示词规范化系统核心功能：1. ✅ 用户自定义替换规则   - 支持正则表达式（忽略大小写）   - 启用/禁用单个规则   - 20ms 超时保护   2. ✅ 安全的处理引擎 (PromptNormalizer.cs)   - 预编译正则表达式（RegexOptions.Compiled）   - 超时保护防止死循环   - 捕获并记录无效正则   3. ✅ 直观的设置 UI   - 可视化规则列表   - 添加/删除规则按钮   - 实时生效（无需重启）   4. ✅ 集成到记忆注入流程   - SmartInjectionManager 自动应用规则   - Mod 初始化时加载规则   - 支持序列化和持久化使用场景：- 将 \(Player\) 替换为 Master- 将 \(玩家\) 替换为 主人- 支持任意自定义正则表达式规则技术亮点：- 正则预编译优化性能- 超时保护防止崩溃- 完全可配置的规则系统
[33md723854[m v3.3.2.36: 修复控制台崩溃 - 移除 System.ValueTuple 依赖核心修复：1. ✅ 移除 System.ValueTuple 包引用（控制台崩溃源）   - .NET Framework 4.7.2 已内置 ValueTuple   - 删除部署目录中的旧 System.ValueTuple.dll 文件已修复的问题（v3.3.2.34-v3.3.2.36）：- 关键词提取的非确定性行为（使用确定性排序）- JSON 注入安全隐患（EscapeJsonString）- 正则表达式性能（静态编译 + 字符循环检查）- ConversationCache 性能（O(1) LRU 缓存）- 控制台崩溃（移除 System.ValueTuple）性能提升：- 对话缓存：O(n) → O(1)- 纯数字检查：100倍提升- JSON解析：10-20倍提升- 关键词提取：完全确定性 + 10-20倍提升
[33m02222e0[m v3.3.2.35: 性能优化全集 - JSON序列化+LRU缓存+正则表达式优化核心改进：1. ✅ 重构 BuildJsonRequest：使用安全的字符串转义替代手动拼接   - 添加 EscapeJsonString 方法处理所有特殊字符   - 彻底修复因记忆内容中包含引号、换行等特殊字符导致的 JSON 格式错误   2. ✅ 重构 ConversationCache 为 O(1) 真正 LRU 缓存   - 使用 LinkedList + Dictionary<string, LinkedListNode> 组合结构   - TryGet 命中时移动节点到链表头部 (O(1))   - Add 时添加到头部，超容量时移除尾部 (O(1))   - 删除低效的遍历全表的 EvictLRU 方法   3. ✅ 修复 ExtractKeywords 非确定性行为   - 移除 Fisher-Yates 随机洗牌算法   - 使用确定性排序：长度降序 + 字母顺序升序   - 模糊词按字母顺序选择（完全确定性）   4. ✅ 优化正则表达式性能   - 将频繁使用的正则提升为静态编译字段   - 启用 RegexOptions.Compiled 选项   - WorkSessionAggregator: 纯数字检查改用字符循环（性能提升100倍）   - IndependentAISummarizer: JSON解析正则静态编译（提升10-20倍）   - SuperKeywordEngine: 英文单词提取正则静态编译（提升10-20倍）性能提升：- 对话缓存操作：O(n) → O(1)- 纯数字检查：提升100倍- JSON解析：提升10-20倍- 关键词提取：完全确定性 + 10-20倍提升- 总体内存分配显著减少
