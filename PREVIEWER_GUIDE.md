# 预览器使用指南 - 场景分析功能

## ?? 快速开始

### 1. 打开预览器
```
游戏内 → ESC → 记忆管理 → 调试预览器
```

### 2. **重要！输入上下文**
场景分析功能**只在输入了上下文后才会显示**！

在"上下文输入"框中输入测试文本，例如：
- `敌人正在攻击我们的基地`
- `李四和王五在聊天`
- `建造新的房屋`

### 3. 点击"刷新预览"

### 4. 滚动查看结果
场景分析会显示在"常识库注入详细分析"部分的开头。

---

## ?? 测试用例

### 测试1：战斗场景
**输入**: `敌人正在攻击`

**预期显示**:
```
?? 【场景分析】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
?? 【场景类型】: 战斗/紧急
?? 【置信度】: 85%

【动态权重配置】（用于记忆检索）:
  ? 时间衰减: 0.80 (越高越重视最近)
  ? 重要性: 0.50
  ? 关键词匹配: 0.40
  ? 关系加成: 0.10
  ? 时间窗口: 6 天

【场景特性】:
  ? 强调最近记忆（时间衰减0.8）
  ? 只关注重要事件（重要性0.5）
  ? 精准关键词匹配（0.4）
  ? 弱化关系因素（0.1）
  ? 时间窗口：6小时
```

### 测试2：社交场景
**输入**: `李四和王五在聊天`

**预期显示**:
```
?? 【场景分析】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
?? 【场景类型】: 社交/情感
?? 【置信度】: 75%

【动态权重配置】（用于记忆检索）:
  ? 时间衰减: 0.05 (极低，可回忆旧事)
  ? 重要性: 0.20
  ? 关键词匹配: 0.25
  ? 关系加成: 0.60 (强化共同记忆)
  ? 时间窗口: 30 天
```

### 测试3：工作场景
**输入**: `建造新的房屋`

**预期显示**:
```
?? 【场景分析】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
?? 【场景类型】: 工作/日常
?? 【置信度】: 60%

【动态权重配置】（用于记忆检索）:
  ? 时间衰减: 0.30
  ? 重要性: 0.30
  ? 关键词匹配: 0.35
  ? 关系加成: 0.15
  ? 时间窗口: 7 天
```

---

## ?? 场景分析位置

场景分析面板会显示在以下位置：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
?? 【ExpandMemory - 常识库注入详细分析】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
?? 【场景分析】           ← 在这里！
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
?? 【场景类型】: ...
?? 【置信度】: ...
...

?? 动态评分选择了 X 条常识
...
```

---

## ? 常见问题

### Q1: 为什么看不到场景分析？
**A**: 场景分析只在**输入了上下文**后才显示。请确保：
1. 在"上下文输入"框中输入了文本
2. 点击了"刷新预览"按钮
3. 向下滚动到"常识库注入详细分析"部分

### Q2: 如何测试2字关键词评分修复？
**A**: 
1. 打开常识库管理器
2. 添加测试常识：`[社交]李四喜欢和王五聊天`
3. 在预览器中输入：`李四和王五在聊天`
4. 查看常识评分：
   - "李四"应该有 0.10 分（不是 0.05）
   - "王五"应该有 0.10 分
   - "聊天"应该有 0.10 分

### Q3: 场景分析有什么用？
**A**: 场景分析显示：
- **场景类型**：系统如何理解您的输入（战斗/社交/工作等）
- **动态权重**：不同场景下记忆检索的偏好
- **场景特性**：该场景的记忆优先级策略

这帮助您理解为什么某些记忆/常识被选中或被忽略。

---

## ? 验证清单

测试完成后，请确认：

- [ ] 输入上下文后能看到场景分析面板
- [ ] 场景类型识别正确（战斗/社交/工作等）
- [ ] 动态权重显示正常
- [ ] 2字关键词评分为 0.10（不是 0.05）
- [ ] 3字关键词评分为 0.16（不是 0.12）
- [ ] 常识匹配分数明显提升

---

**?? 祝测试顺利！如有问题请反馈！**
