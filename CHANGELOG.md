# RimTalk - Expand Memory 更新日志

## v3.3.19 (2025-01-XX) - Mind Stream UI ??

### 重大更新

#### ?? Mind Stream UI - 全新记忆时间线
- **卡片式布局**：垂直滚动的记忆卡片，每个卡片带彩色边框
- **拖拽多选**：
  - 支持 Ctrl + 点击多选/取消
  - 支持 Shift + 点击范围选择
  - 支持鼠标拖拽框选
- **智能过滤**：
  - 按层级过滤：ABM / SCM / ELS / CLPA
  - 按类型过滤：对话 / 行动
  - 实时显示过滤结果数量
- **实时统计**：
  - 各层记忆数量（ABM: 3/3, SCM: 15/20, etc）
  - 选中项数量实时显示
- **批量操作**：
  - 总结选中的记忆（SCM → ELS）
  - 归档选中的记忆（ELS → CLPA）
  - 删除选中的记忆（带确认）
- **彩色层级指示**：
  - ABM（超短期）：青色 (Cyan)
  - SCM（短期）：绿色 (Green)
  - ELS（事件日志）：黄色 (Yellow)
  - CLPA（档案）：紫色 (Purple)
- **自适应卡片高度**：
  - ABM: 80px（最紧凑）
  - SCM: 100px
  - ELS: 130px
  - CLPA: 160px（最大，显示最多内容）

#### ?? 图书馆风格常识库 UI
- **三栏布局**：
  - 左侧：分类导航栏
  - 中间：常识列表
  - 右侧：详情/编辑面板（可折叠）
- **分类过滤**：
  - 全部
  - 规则（Instructions）
  - 世界观（Lore）
  - 角色状态（PawnStatus）
  - 历史（History）
  - 其他（Other）
- **多选操作**：
  - Ctrl/Shift/拖拽多选
  - 批量启用/禁用
  - 批量导出选中项
  - 批量删除
- **搜索功能**：按标签或内容实时搜索
- **自动生成**：
  - Pawn 状态自动生成（展开"自动生成设置"）
  - 事件记录自动生成
- **可视化管理**：
  - 新建常识（按钮 + 表单）
  - 编辑常识（右侧面板）
  - 导入/导出（支持选中项导出）
  - 删除（带确认）

### 优化改进

#### ??? 代码清理
- **移除旧 UI 文件**：
  - 删除 `MainTabWindow_Memory_MindStream.cs`（测试文件）
  - 删除 `Dialog_CommonKnowledge_Library.cs`（测试文件）
  - 合并所有功能到主文件中
- **独立 Dialog 类**：
  - 创建 `Dialog_TextInput.cs` 作为独立的文本输入对话框

#### ?? 完整翻译支持
- **新增 100+ 翻译键**：
  - 所有 UI 元素（按钮、标签、提示）
  - 所有消息（成功/错误/确认）
  - 所有工具提示（Tooltips）
- **双语支持**：
  - English（完整）
  - ChineseSimplified（完整）
- **翻译文件**：
  - `Languages/English/Keyed/MemoryPatch.xml`
  - `Languages/ChineseSimplified/Keyed/MemoryPatch.xml`

### 技术细节

#### UI 架构
- **MainTabWindow_Memory**：
  - 使用 Mind Stream 时间线布局
  - 支持多选和拖拽操作
  - 左侧控制面板 + 右侧时间线
- **Dialog_CommonKnowledge**：
  - 使用图书馆风格三栏布局
  - 支持分类导航和多选操作
  - 侧边栏 + 列表 + 详情面板
- **Dialog_TextInput**：
  - 独立的文本输入对话框
  - 支持多行模式
  - 用于常识导入功能

#### 性能优化
- **拖拽选择**：
  - 使用矩形碰撞检测
  - O(n) 复杂度，n 为当前过滤后的记忆数量
- **多选管理**：
  - HashSet 存储选中项，O(1) 查找
  - 支持 Ctrl/Shift 键盘辅助
- **UI 渲染**：
  - 自适应卡片高度减少空白
  - 滚动视图只渲染可见区域

### 向后兼容
- ? 完全兼容旧存档
- ? 自动迁移旧的记忆数据
- ? 保留所有现有功能

### 已知问题
- 无

---

## v3.3.14 (2025-01-XX)

### 新增功能
- ?? **记忆自动清理系统**：
  - Activity 阈值清理（< 0.01）
  - 容量限制强制执行
  - 三重保护机制
  - 每小时自动执行

### 文档更新
- 新增 `MEMORY_CLEANUP_SYSTEM.md`

---

## v3.3.13 (2025-01-XX)

### 优化改进
- ?? **常识库评分优化**：
  - 2字关键词：0.05 → 0.10 (+100%)
  - 3字关键词：0.12 → 0.16 (+33%)
- ?? **场景分析显示**
- ?? **关键词列表显示**

### 文档更新
- 新增 `KNOWLEDGE_SCORING_DIAGNOSTIC.md`
- 新增 `PREVIEWER_GUIDE.md`

---

## v3.3.2.38 (2025-01-XX)

### 优化改进
- ?? **名字识别优化**：
  - 双角色名字识别
  - 名字匹配加成 +0.3
- ??? **标签解析容错**

---

## v3.3.2.37 (2025-01-XX)

### 新增功能
- ? **提示词规范化系统**：
  - 用户自定义替换规则
  - 正则表达式支持
  - 实时生效

---

## v3.3.2.34-v3.3.2.36 (2025-01-XX)

### 优化改进
- ?? 性能优化大礼包
- ?? 修复控制台崩溃

---

## 更早版本

请参考 GitHub Release 页面：
https://github.com/sanguodxj-byte/RimTalk-ExpandMemory/releases
