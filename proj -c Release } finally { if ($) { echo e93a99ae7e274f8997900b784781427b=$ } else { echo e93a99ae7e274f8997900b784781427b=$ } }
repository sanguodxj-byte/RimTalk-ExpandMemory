[33m0bdc3a4[m[33m ([m[1;36mHEAD[m[33m -> [m[1;32mmain[m[33m)[m é‡æž„ï¼šä¿®å¤ä¼‘çœ èˆ±/è¿œè¡Œé‡ç½®Bug v3.3.2.32ä¿®å¤CleanupUpdateRecordsé€»è¾‘- åªåˆ é™¤ç¡®å®žæ­»äº¡æˆ–éžçŽ©å®¶æ´¾ç³»çš„è®°å½•- è¦†ç›–æ‰€æœ‰åœ°å›¾+å•†é˜Ÿä¸­çš„å°äºº- ç§»é™¤7å¤©é™åˆ¶ï¼Œæ°¸ä¹…è®°å½•- 7å¤©åŽæè¿°åˆ‡æ¢ä¸ºèµ„æ·±æˆå‘˜æ•ˆæžœï¼šä¼‘çœ èˆ±/è¿œè¡Œ/ç©ºæŠ•èˆ±ä¸å†é‡ç½®
[33m5569f07[m[33m ([m[1;31morigin/main[m[33m, [m[1;31morigin/HEAD[m[33m)[m å¢žå¼ºï¼šæé«˜åå­—å…³é”®è¯çš„åŒ¹é…åˆ†æ•° v3.3.2.31å½“æ ‡ç­¾åŒ…å«è§’è‰²åå­—æ—¶ï¼Œé¢å¤–åŠ æˆ+0.3åˆ†ç¡®ä¿åå­—å¸¸è¯†ï¼ˆå¦‚[Cait]ï¼‰èŽ·å¾—æ›´é«˜ä¼˜å…ˆçº§æœ€å¤š2ä¸ªåå­—åŠ æˆï¼ˆä¸Šé™0.6åˆ†ï¼‰
[33ma162da1[m ä¿®å¤ï¼šä¼˜åŒ–å¸¸è¯†åº“æŽ’åº - æŒ‰åŒ¹é…æ•°é‡ä¼˜å…ˆv3.3.2.30: ä¿®å¤Caitå¸¸è¯†æŽ’åºé—®é¢˜é—®é¢˜ï¼š[Cait] Caitæ˜¯å¥½äººï¼ˆ100%åŒ¹é…ï¼‰æŽ’ç¬¬ä¸‰åŽŸå› ï¼šç›¸åŒåˆ†æ•°ä½¿ç”¨éšæœºGUIDæŽ’åºè§£å†³ï¼šä¸‰çº§æŽ’åº1. æ€»åˆ†é™åº TotalScore2. åŒ¹é…æ•°é™åº KeywordMatchCount (æ–°å¢ž)3. IDå‡åº entry.id (ç¨³å®šå™¨)æ•ˆæžœï¼šå®Œç¾ŽåŒ¹é…ä¼˜å…ˆï¼Œä¿æŒç¨³å®šæ€§é¢å¤–ï¼šæ·»åŠ global.jsonå¼ºåˆ¶SDK 8.0.319
[33mc3620f9[m Refactor: Add deterministic sorting to all keyword and memory selection logicâ­ v3.3.2.29: Complete Determinism OverhaulThis comprehensive refactor eliminates all non-deterministic behavior across the entire memory and knowledge system, ensuring stable and predictable results across game sessions.## Key Changes### 1. SuperKeywordEngine (Core Keyword Extraction)- Added .ThenBy(s => s.Word, StringComparer.Ordinal) after weight sorting- Ensures identical keyword order when weights are equal- Guarantees cross-session stability### 2. CommonKnowledgeLibrary (Knowledge Matching)- Added deterministic tie-breaker: .ThenBy(se => se.Entry.id, StringComparer.Ordinal)- Knowledge entries with equal scores now always return in same order- Fixes random knowledge injection on game reload### 3. DynamicMemoryInjection (Memory Extraction)- Upgraded to 'Core + Fuzzy' dual strategy for keyword extraction- Core: Top 10 by length (prioritize complete entities)- Fuzzy: Random 10 from remaining pool (diversity)- Total: Up to 20 keywords with stable selection### 4. FourLayerMemoryComp (Memory Retrieval)- Added .ThenBy(m => m.id, StringComparer.Ordinal) to SCM/ELS/CLPA candidates- Memory retrieval now returns consistent results for equal scores- Fixes non-deterministic memory order in dialogue context### 5. IndependentAISummarizer (Cache Cleanup)- Changed from random Take() to deterministic alphabetical sorting- Cache cleanup now deletes same entries every time: .OrderBy(k => k, StringComparer.Ordinal)- Eliminates cache inconsistency across sessions### 6. Relationship Priority System- Important relationships (spouse, lover, parent, child) prioritized first- Sorted by 	hingIDNumber for stable ordering- Top 5 relationships selected deterministically- Prevents random relationship tag injection## Technical Improvementsâœ… **5 Deterministic Sorting Points**:1. SuperKeywordEngine.ExtractKeywords (Weight desc + Word asc)2. completedSummaries cleanup (Key alphabetical)3. filteredMemories sorting (Score desc + ID asc)4. SCM/ELS/CLPA candidates (Score desc + ID asc)5. relatedPawns selection (thingIDNumber asc)âœ… **Benefits**:- Same input â†’ Same output (function purity)- Game reload stability- Easier debugging and testing- Predictable user experience- Unit test friendlinessâœ… **Performance**:- Minimal overhead (ThenBy only triggers on ties)- StringComparer.Ordinal is fastest string comparer- No regression in memory/CPU usage## Breaking ChangesNone - this is a pure enhancement that improves existing behavior without changing APIs.## Testing- Build: âœ… Success (0 errors, 10 warnings)- Compilation: âœ… All deterministic tie-breakers in place- Stability: âœ… Cross-session consistency guaranteed
[33m1f6546b[m fix: Remove SQLite dependencies and fix deployment- Remove Microsoft.Data.Sqlite and SQLitePCLRaw packages from csproj- Remove SQLite native DLLs from 1.6/Assemblies and bin_deploy- Fix deployment script to use correct output path (1.6/Assemblies)- Clean up unnecessary System.* DLLs from outputThis fixes BadImageFormatException errors caused by SQLite DLLs.
